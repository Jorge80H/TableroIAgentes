
***

# üìå Backlog Completo ‚Äì Dashboard de Conversaciones (AI + Humano)

### üß© Estructura de √âpicas

1. **Autenticaci√≥n y Usuarios**
2. **Gesti√≥n de Agentes**
3. **Gesti√≥n de Conversaciones**
4. **Integraci√≥n con n8n / WhatsApp**
5. **Seguridad y Multi-Tenant**
6. **Notificaciones y Tiempo Real**
7. **Infraestructura y DevOps**

***

## 1. √âpica: Autenticaci√≥n y Usuarios

### Historia 1.1 ‚Äì Registro de usuario Superadministrador

**Como** administrador de toda la app super administrador persona de Empleados digitales
**Quiero** Registrarme con email + contrase√±a
**Para** acceder a mi cuenta de super administrador, para crear cuentas de usarios y empresas para crear los agentes, conectar los agentes a los webhooks de n8n, asignarlos a las empresas y toda la administracion de la app.

- **Criterios de aceptaci√≥n:**
    - Registrar nombre, email, contrase√±a, nombre de empresa.
    - Validaci√≥n de email √∫nico.
    - Password hasheado (bcrypt/argon2).
    - Confirmaci√≥n por email (opcional).
- **Notas t√©cnicas:**
    - Backend: JWT + refresh tokens.
    - DB: tabla `users` con relaci√≥n 1:N con `organizations`.

***

### Historia 1.2 ‚Äì Login de usuario

**Como** usuario (admin/agent)
**Quiero** loguearme con email y contrase√±a
**Para** acceder a mis agentes y conversaciones.

- **Criterios de aceptaci√≥n:**
    - Token JWT v√°lido por X horas.
    - Refresh token renovable.
    - Acceso limitado a los recursos de su organizaci√≥n.

***

*

## 2. √âpica: Gesti√≥n de Agentes

### Historia 2.1 ‚Äì Creaci√≥n de agente

**Como** administrador
**Quiero** crear un nuevo agente vinculado a WhatsApp/n8n
**Para** que atienda clientes autom√°ticamente.

- **Criterios de aceptaci√≥n:**
    - Formulario: nombre agente, credenciales de integraci√≥n (webhook URL, token).
    - Guardar agente en DB vinculado a organizaci√≥n.
- **Notas t√©cnicas:**
    - Tabla `agents`: id, name, org_id, webhook_url, api_token.

***

### Historia 2.2 ‚Äì Listado de agentes

**Como** usuario autenticado
**Quiero** ver todos mis agentes creados
**Para** administrar y monitorear qu√© bots tengo activos.

***

## 3. √âpica: Gesti√≥n de Conversaciones

### Historia 3.1 ‚Äì Bandeja de chats

**Como** agente humano
**Quiero** ver la lista de conversaciones activas
**Para** seleccionar una y atender.

- **Criterios de aceptaci√≥n:**
    - UI estilo ‚Äúinbox‚Äù: listado en la izquierda, contenido chat en la derecha.
    - Mostrar cliente, √∫ltimo mensaje, hora.
- **Notas t√©cnicas:**
    - WebSockets para actualizar en tiempo real.
    - DB: `conversations`, `messages`.

***

### Historia 3.2 ‚Äì Control humano vs IA

**Como** agente humano
**Quiero** tomar control de una conversaci√≥n
**Para** que el cliente reciba respuestas m√≠as en vez de la IA.

- **Criterios de aceptaci√≥n:**
    - Bot√≥n ‚ÄúTomar control‚Äù ‚Üí cambia estado del agente a ‚Äúhumano activo‚Äù.
    - Bot√≥n ‚ÄúDevolver a IA‚Äù ‚Üí reactiva el bot.
    - Logs auditados: qu√© usuario tom√≥ el control y cu√°ndo.
- **Notas t√©cnicas:**
    - Estado de conversaci√≥n: `AI_ACTIVE | HUMAN_ACTIVE`.
    - Mensajes etiquetados con `sender_type: AI | HUMAN | CLIENT`.

***

### Historia 3.3 ‚Äì Visualizaci√≥n de mensajes

**Como** usuario
**Quiero** ver los mensajes del cliente, AI y humano con formato diferenciado
**Para** saber claramente qui√©n dijo qu√©.

- **UI:** burbuja azul = humano, verde = AI, gris = cliente.

***

## 4. √âpica: Integraci√≥n con n8n / WhatsApp

### Historia 4.1 ‚Äì Recepci√≥n de mensajes entrantes

**Como** sistema
**Quiero** recibir mensajes desde n8n
**Para** mostrarlos en el dashboard.

- **Criterios de aceptaci√≥n:**
    - Endpoint webhook `/webhooks/messages` recibe payload JSON desde n8n.
    - Guarda mensaje en DB ‚Üí emite a WebSocket para frontend.
- **Notas t√©cnicas:**
    - Payload standard: { conversation_id, sender, message, timestamp }.
    - Seguridad: validar token desde n8n.

***

### Historia 4.2 ‚Äì Env√≠o de mensajes hacia WhatsApp

**Como** agente humano o AI
**Quiero** enviar mensajes que salgan v√≠a n8n ‚Üí WhatsApp
**Para** que lleguen al cliente final.

- **Criterios de aceptaci√≥n:**
    - API interna `/send-message` que llama webhook de n8n.
    - Respuesta de error si no se logra enviar.

***

## 5. √âpica: Seguridad y Multi-Tenant

### Historia 5.1 ‚Äì Aislamiento por organizaci√≥n

**Como** usuario
**Quiero** ver solo mis agentes/conversaciones
**Para** proteger la privacidad entre empresas.

- **Criterios de aceptaci√≥n:**
    - `org_id` en todas las queries.
    - Middleware que asegure permisos.

***

### Historia 5.2 ‚Äì Auditor√≠a y logs

**Como** admin
**Quiero** ver qu√© usuarios tomaron control de qu√© conversaciones
**Para** tener trazabilidad.

- **Criterios de aceptaci√≥n:**
    - Tabla `audit_logs`: user_id, conversation_id, action, timestamp.

***

## 6. √âpica: Notificaciones y Tiempo Real

### Historia 6.1 ‚Äì Notificaci√≥n de nuevos mensajes

**Como** agente
**Quiero** recibir alertas cuando entra un nuevo mensaje
**Para** poder responder r√°pido.

- **Notas t√©cnicas:**
    - WebSockets (Socket.IO o equivalente).
    - Push notifications (opcional PWA).

***

## 7. √âpica: Infraestructura y DevOps

### Historia 7.1 ‚Äì Deploy inicial

**Como** equipo t√©cnico
**Quiero** desplegar en cloud
**Para** acceder con alta disponibilidad.

- **Stack recomendado:**
    - **Frontend:** React.js / Next.js.
    - **Backend:** Node.js (NestJS) + Express.
    - **DB:** PostgreSQL.
    - **Mensajer√≠a en tiempo real:** WebSocket.
    - **Infra:** Docker + Kubernetes (o ECS).
    - **Env:** Staging + Prod.

***

# üìä Modelo de Datos (Simplificado)

**users** (id, name, email, password_hash, role, org_id)
**organizations** (id, name)
**agents** (id, name, org_id, webhook_url, api_key)
**conversations** (id, agent_id, client_phone, status)
**messages** (id, conversation_id, sender_type [AI/HUMAN/CLIENT], content, timestamp)
**audit_logs** (id, user_id, conversation_id, action, timestamp)

***

# üöÄ Tecnolog√≠as Recomendadas

- **Frontend:**
Next.js + TailwindCSS + Zustand/Recoil (gesti√≥n de estado).
- **Backend:**
NestJS + PostgreSQL + Redis (cache y colas) + Prisma.
- **Integraciones:**
Webhooks + n8n (flujo WhatsApp).
- **Infraestructura:**
Docker + CI/CD (GitHub Actions o GitLab CI).
Hosting en Railway/Vercel para prototipos, AWS/GCP/Azure en producci√≥n.

***

Esto lo puedes meter directamente en Jira/Trello como √©picas e historias. üéØ

üëâ ¬øQuieres que adem√°s te prepare un **diagrama de arquitectura del sistema** (componentes backend, frontend, n8n, WhatsApp) para que quede ultra claro para tu equipo t√©cnico?

